<div class="dashboard">
  <header class="dashboard-header">
    <div>
      <h1>Valencia, España</h1>
      <p>Monitoreo en tiempo real de calidad ambiental y tráfico</p>
      <p class="updated-at">Actualizado: {{ airQuality()?.lastUpdated || '--' }}</p>
    </div>
    <div class="air-index-card">
      <span>Índice de Calidad del Aire</span>
      <strong>{{ airQuality()?.aqi ?? '--' }}</strong>
      <span class="badge">{{ airQuality()?.category || 'Sin datos' }}</span>
    </div>
  </header>

  <section class="summary-grid">
    <article class="card">
      <div class="title-container">
        <i class="fa-solid fa-cloud pollution-icon"></i>
        <h2>Contaminación</h2>
      </div>
      <p class="main-value">
        {{ pm25Value() }}
        <span class="main-unit">PM2.5 µg/m³</span>
      </p>

      @if (otherPollutants().length) {
        <ul class="pollutants">
          @for (p of otherPollutants(); track p.name) {
            <li>
              <span class="pollutant-name">{{ p.name }}</span>
              <div class="progress-bar-container">
                <div class="progress-bar" [style.width.%]="getPollutantPercentage(p)"></div>
              </div>
              <span class="pollutant-value">{{ p.value }} {{ p.unit }}</span>
            </li>
          }
        </ul>
      } @else {
        <p>No hay datos de contaminantes disponibles.</p>
      }
    </article>

    <article class="card">
      <div class="title-container">
        <i class="fas fa-car traffic-icon"></i>
        <h2>Tráfico</h2>
      </div>
      <app-trafico />
    </article>

    <article class="card">
      <div class="title-container">
        <i class="fas fa-cloud-showers-heavy precipitation-icon"></i>
        <h2>Precipitaciones</h2>
      </div>
      <p class="main-value">
        {{ (weather()?.rain ?? 0) | number : '1.1-1' }}
        <span class="main-unit">mm/hora</span>
      </p>
      
      <ul class="weather-details">
        <li>
          <span class="detail-label">Humedad</span>
          <div class="progress-bar-container">
            <div class="progress-bar" [style.width.%]="humidity()"></div>
          </div>
          <span class="detail-value">{{ humidity() }}%</span>
        </li>
        <li>
          <span class="detail-label">Prob. Lluvia</span>
          <div class="progress-bar-container">
            <div class="progress-bar" [style.width.%]="(weather()?.rainProbability ?? 0)"></div>
          </div>
          <span class="detail-value">{{ (weather()?.rainProbability ?? 0) }}%</span>
        </li>
        <li>
          <span class="detail-label">Acumulado 24h</span>
          <span class="detail-value">{{ (weather()?.rain24h ?? 0) | number : '1.1-1' }} mm</span>
        </li>
      </ul>
    </article>
  </section>

  <section class="bottom-grid">
    <article class="card large">
      <h2>Evolución de Contaminación</h2>
      <app-grafico-contaminacion></app-grafico-contaminacion>
    </article>

    <article class="card large">
      <h2>Mapa de Calor - Contaminación</h2>
      <div class="placeholder-map">Mapa en desarrollo</div>
    </article>
  </section>
</div>

